<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>历史记录查询</title>
<style type="text/css">
	.fc-ltr .fc-basic-view .fc-day-number{
		text-align: left;
		font-size: 150%;
	}
	
	.white-color{
		color: #fff !important;
	}
	
	.event:hover{
		color:black !important;
	}
	
	.event{
		background:none;
		border:none;
		color:black;
		/* margin-top: 28px; */
		color:#878d97;
		font-size:16px;
		text-align: center;
	}

	#calendar {
		max-height: 100%;
	}
	
	.calendar-detail{
		background-color: #eceef1;
		width: 250px;
		position: absolute;
		bottom: 8px;
		top: 8px;
		right: 8px;
		border: 1px solid #b2b8c3;
		overflow-x: auto;
	}
	
	.calendar-detail .block{
		border-top: 1px solid #b2b8c3;
		margin-top: -1px;
		height: auto;
		padding:2px 2px 2px 8px;
		position: relative;
	}
	
	.calendar-detail .block > p {
		margin: 5px 0 5px 0;
	}
	
	.calendar-detail .block:hover{
		border:2px solid #0092F3;
		padding:1px 0 0 6px;
		cursor: pointer;
	}
	
	.calendar-detail .block:hover > .history-switch{
		display: inline-block;
	}
	
	.calendar-detail .block > .history-switch{
		display: none;
		width: 32px;
		height: 32px;
		position: absolute;
		right: 0px;
		top: 0px;
		background-image: url("css/img/history-switch.png");
	}
	
	.fc-toolbar .fc-left{
		margin-left: 30%;
	}
	
	.fc-toolbar .fc-right{
		margin-right: 30%;
	}
	
	.fc button {
	    padding: 4px 25px;
	}
	.fc-unthemed .fc-today{
	   background-color: #FF5C58;
	}
	
	.select{
	    width: 0;
	    height: 0;
	    border-left: 8px solid transparent;
	    border-right: 8px solid transparent;
	    border-top: 8px solid #989EAF;
	    margin-top: 10px;
	    cursor: pointer;
	}
	
	.select:hover{
	    width: 0;
	    height: 0;
	    border-left: 8px solid transparent;
	    border-right: 8px solid transparent;
	    border-top: 8px solid #55adff;
	    margin-top: 10px;
	}
	
	.dayDiv{
		border: 1px solid none;
	}
	
	.dayDiv.active{
		border: 1px solid red;
	}
	
	.fc-day{
		cursor: pointer;
	}
	
</style>
<body>
	<div id='calendar' class="fl"></div>
	<div class="calendar-detail">
		<div class="block">
			<p>搜索日期：<span>2015-09-12</span></p>
			<p>搜索时间：<span>16:36:49</span></p>
			<p>搜索结果：<span>9927条记录</span></p>
			<p>时&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;间：<span>9927条记录</span></p>
			<p>车辆颜色：<span>红色</span></p>
			<p>车辆大小：<span>大货车</span></p>
			<p>车辆类型：<span>大货车</span></p>
			<p>系安全带：<span>未知</span></p>
			<p>任务ID：<span>未知</span></p>
			<span class="history-switch"></span>
		</div>
		<div class="block">
			<p>搜索日期：<span>2015-09-12</span></p>
			<p>搜索时间：<span>16:36:49</span></p>
			<p>搜索结果：<span>9927条记录</span></p>
			<p>时&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;间：<span>9927条记录</span></p>
			<p>车辆颜色：<span>红色</span></p>
			<p>车辆大小：<span>大货车</span></p>
			<p>车辆类型：<span>大货车</span></p>
			<p>系安全带：<span>未知</span></p>
			<p>任务ID：<span>未知</span></p>
			<span class="history-switch"></span>
		</div>
		<div class="block">
			<p>搜索日期：<span>2015-09-12</span></p>
			<p>搜索时间：<span>16:36:49</span></p>
			<p>搜索结果：<span>9927条记录</span></p>
			<p>时&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;间：<span>9927条记录</span></p>
			<p>车辆颜色：<span>红色</span></p>
			<p>车辆大小：<span>大货车</span></p>
			<p>车辆类型：<span>大货车</span></p>
			<p>系安全带：<span>未知</span></p>
			<p>任务ID：<span>未知</span></p>
			<span class="history-switch"></span>
		</div>
	</div>
	<script type="text/javascript">
		renderCalendar();
		resizeEvent();
		addBlockLinkEvent();
		
		function resizeEvent(){
			var calendarHeight = $('#page-content').height();
			var calendarWidth = $('#page-content').width()
			$('#calendar').fullCalendar('option', 'height', calendarHeight-4);
			$('#calendar').width(calendarWidth-270);
		}
		
		function addBlockLinkEvent(){
			$('.block').click(function(){
				window.open("search_result.html");
			});
		} 
		
		/*时间日期格式化*/
		function dataFormatter (dateObject) {
			   var d = new Date(dateObject);
			   var day = d.getDate();
			   var month = d.getMonth() + 1;
			   var year = d.getFullYear();
			   if (day < 10) {
			      day = "0" + day;
			   }
			   if (month < 10) {
			      month = "0" + month;
			   }
			   var date = year + "-" + month + "-" + day;
	
			   return date;
		};
			
		/*渲染日历组件 日历自己按使用fullCalendar框架*/
		function renderCalendar() {
			$('#calendar').fullCalendar({
				header: {
					left: 'prev',
					center: 'title',
					right: 'next'
				},
				lang: 'zh-cn',
				buttonIcons: false, 
				weekNumbers: false,
				editable: false,
				eventLimit: false,
				backgroundColor : 'yellow',
				dayClick: function(date, allDay,view) {
					var dateString = dataFormatter(date);
					view.el.find('.fc-day').removeClass('active');
					view.el.find('.fc-day[data-date="' + dateString + '"] > .dayDiv').addClass('active');
					alert(dateString);
				},
				eventClick:function(event, element,view){
					var dateString = dataFormatter(event.start);
					view.el.find('.fc-day[data-date="' + dateString + '"] > .dayDiv').addClass('active');
					alert(dateString);
				},
				eventRender: function(event, element,view) {
					$(element).addClass("event");
					var dateString = dataFormatter(event.start);
					var dayElement = view.el.find('.fc-day-number[data-date="' + dateString + '"]');
					if(!dayElement.hasClass('fc-today')){
	     				view.el.find('.fc-day-number[data-date="' + dateString + '"]').css('background-color', '#3bd6be');
					}else{
						$(element).addClass("white-color");
					}
				},
				eventAfterAllRender:function(){
					if(!$('.fc-center').find(".select")[0]){
						var $select = $('<div/>').addClass("select");
						$('.fc-center').append($select);
						$select.click(function(){
							$(this).datetimepicker({
								lang:'ch',
								timepicker:false,
								mouthpicker:true,
								inverseButton:true,
								todayButton: true,
								prevButton: false,
								nextButton: false,
								format:'Y-m',
								onChangeMonth:function(){
									var date = $select.data('xdsoft_datetimepicker').data('xdsoft_datetime');
									$('#calendar').fullCalendar( 'gotoDate', $.fullCalendar.moment(date.str()));
								}
							});
							$(this).datetimepicker('show');
						});
					}
					var height = $('.fc-day').height();
					$('.fc-day').append($('<div/>').addClass("dayDiv").height(height));
				},
				events:function(start, end, timezone, callback) {
					/*实际情况根据start和end走后端ajax*/
			        $.ajax({
			            url:"data.json",
			            dataType: "json", 
			            type:"post",
			            success:function(events) {
			                callback(events);
			            },
			            error:function() {
			            }
			        })
			    }
			});
		}
	</script>
</body>
</html>